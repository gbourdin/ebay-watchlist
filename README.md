# ebay-watchlist
[![CI](https://github.com/gbourdin/ebay-watchlist/actions/workflows/ci.yml/badge.svg?branch=main)](https://github.com/gbourdin/ebay-watchlist/actions/workflows/ci.yml)
[![codecov](https://codecov.io/gh/gbourdin/ebay-watchlist/branch/main/graph/badge.svg)](https://codecov.io/gh/gbourdin/ebay-watchlist)
[![Docker Pulls](https://img.shields.io/docker/pulls/gbourdin/ebay-watchlist)](https://hub.docker.com/r/gbourdin/ebay-watchlist)
[![Docker Image Version](https://img.shields.io/docker/v/gbourdin/ebay-watchlist?sort=semver)](https://hub.docker.com/r/gbourdin/ebay-watchlist/tags)

Track newly listed eBay auctions from selected sellers and categories, store results in SQLite, and browse them in a Flask UI.

## Requirements
- Python 3.14
- `uv` (dependency and task runner)

## Setup
```bash
cp .env.example .env
uv sync --dev
uv run ebay-watchlist config init-database
uv run ebay-watchlist config load-defaults
```

Set required credentials in `.env`:
- `EBAY_CLIENT_ID`
- `EBAY_CLIENT_SECRET`

## Run Locally
```bash
uv run ebay-watchlist fetch-updates --limit 100
uv run ebay-watchlist run-flask --host 127.0.0.1 --port 8000 --debug
```

Other useful commands:
- `uv run ebay-watchlist show-latest-items --limit 50`
- `uv run ebay-watchlist cleanup-expired-items --retention-days 180`
- `uv run ebay-watchlist run-loop --cleanup-retention-days 180 --cleanup-interval-minutes 1440`
- `uv run ebay-watchlist config --help`

## Web UI Highlights
- Named quick filters in the header (`Musical Instruments`, `Computers`, `Videogames`).
- Multi-select autocomplete tag filters for sellers, main categories, and categories.
- Category suggestions are scoped to selected main categories (based on tracked listings).
- Tag filters apply automatically as you add/remove tags; no apply/reset buttons.
- Search submits when pressing Enter in the search box.
- Filter panel is collapsible, starts collapsed, and persists state via local storage.
- Sort includes `Ending Soon` and excludes already-ended items.
- Table/Cards view toggle and full pagination controls (100 items per page by default).

## Quality Checks
```bash
make lint
make typecheck
make test
make ci
```

Direct equivalents:
- `uv run ruff check src`
- `uv run ty check src`
- `uv run pytest -q`

GitHub Actions (`.github/workflows/ci.yml`) runs lint, type checking, and tests with coverage on pushes to `main` and pull requests targeting `main`.

## Release Automation
`/.github/workflows/release.yml` handles Docker publishing and GitHub releases:
- Push to `main` builds and publishes `gbourdin/ebay-watchlist:latest`.
- Push tag `vX.Y.Z`:
  - creates a GitHub release with autogenerated notes since the previous release/tag
  - builds and publishes `gbourdin/ebay-watchlist:X.Y.Z` (the `v` prefix is removed)

Required repository secrets:
- `DOCKERHUB_USERNAME`
- `DOCKERHUB_TOKEN`
- `CODECOV_TOKEN` (for coverage upload in CI)

## Docker
`docker-compose.yml` includes a production-oriented example. Adjust build paths, volume paths, and env file paths for your environment.

## Troubleshooting
- If `fetch-updates` fails, verify `EBAY_CLIENT_ID` and `EBAY_CLIENT_SECRET`.
- If the UI is empty, run `fetch-updates` first and confirm `DATABASE_URL`.
