# ebay-watchlist
[![CI](https://github.com/gbourdin/ebay-watchlist/actions/workflows/ci.yml/badge.svg?branch=main)](https://github.com/gbourdin/ebay-watchlist/actions/workflows/ci.yml)
[![codecov](https://codecov.io/gh/gbourdin/ebay-watchlist/branch/main/graph/badge.svg)](https://codecov.io/gh/gbourdin/ebay-watchlist)
[![Docker Pulls](https://img.shields.io/docker/pulls/gbourdin/ebay-watchlist)](https://hub.docker.com/r/gbourdin/ebay-watchlist)
[![Docker Image Version](https://img.shields.io/docker/v/gbourdin/ebay-watchlist?sort=semver)](https://hub.docker.com/r/gbourdin/ebay-watchlist/tags)

Track eBay auctions from watched sellers/categories, persist them in SQLite, and triage results through a modern SPA frontend backed by a Flask API.

## Requirements
- Python 3.14
- `uv`
- Node.js 20+ and npm

## Setup
```bash
cp .env.example .env
uv sync --dev
npm --prefix frontend install
uv run ebay-watchlist config init-database
uv run ebay-watchlist config load-defaults
```

Set required credentials in `.env`:
- `EBAY_CLIENT_ID`
- `EBAY_CLIENT_SECRET`

## Run Locally (Production-Like)
```bash
uv run ebay-watchlist fetch-updates --limit 100
npm --prefix frontend run build
uv run ebay-watchlist run-gunicorn --host 127.0.0.1 --port 5001 --workers 2
```

- API and SPA are served together at `http://127.0.0.1:5001`
- SPA routes: `/`, `/manage`, `/analytics`

### Local Development (Flask + Vite)
```bash
uv run ebay-watchlist run-flask --host 127.0.0.1 --port 5001 --debug
npm --prefix frontend run dev
```

- API: `http://127.0.0.1:5001`
- Vite dev UI: `http://127.0.0.1:5173`

Other useful CLI commands:
- `uv run ebay-watchlist show-latest-items --limit 50`
- `uv run ebay-watchlist cleanup-expired-items --retention-days 180`
- `uv run ebay-watchlist run-loop --cleanup-retention-days 180 --cleanup-interval-minutes 1440`

## UI Highlights (Phase 1 SPA)
- Full-width pinned navbar and collapsible left filter sidebar.
- Manual light/dark mode toggle in navbar with sun/moon icons.
- Default theme follows device `prefers-color-scheme` when no override is stored.
- User override is only persisted when it differs from system theme (`ebay-watchlist.theme` key).
- If selected mode matches system mode again, stored preference is removed automatically.
- Live filtering with URL query-state sync and no full page reloads.
- Default dense table triage view with large square thumbnails and eBay-linked titles.
- `Posted` and `Ends` columns are both present in dense view for fast recency triage.
- `Posted` and `Ends` are humanized in the SPA, with exact timestamps available on hover.
- Alternate `Hybrid` and `Cards` views for comparison/testing.
- Row actions include `Fav`, `Hide`, and `Note`.
- `Fav` and `Hide` buttons stay visually highlighted when active.
- Per-item note editing is available from each view (`Note` action).
- Mobile-first behavior: results first, filters closed until opened from menu.

## Quality Checks
Backend:
```bash
make lint
make typecheck
make test
make ci
```

Frontend:
```bash
npm --prefix frontend run lint
npm --prefix frontend run test
npm --prefix frontend run build
```

Smoke docs check:
- `uv run pytest tests/docs/test_readme_frontend_commands.py -q`

## Docker
Use the shared image setup:
```bash
docker compose up api daemon
```

- `api` runs Gunicorn on `5001` and serves both API + built SPA
- `daemon` runs periodic fetch/cleanup

## Release Automation
`/.github/workflows/release.yml` handles Docker publishing and GitHub releases:
- Push to `main` builds and publishes `gbourdin/ebay-watchlist:latest`.
- Push tag `vX.Y.Z`:
  - creates a GitHub release with autogenerated notes
  - builds and publishes `gbourdin/ebay-watchlist:X.Y.Z` (without `v` prefix)

## Troubleshooting
- If `fetch-updates` fails, verify `EBAY_CLIENT_ID` and `EBAY_CLIENT_SECRET`.
- If `/` shows a message about missing SPA assets, run `npm --prefix frontend run build`.
- If using Vite dev mode, ensure API is running on `:5001` and Vite on `:5173`.
- If `run-gunicorn` is missing, run `uv sync --dev` to install dependencies.
